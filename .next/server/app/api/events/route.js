"use strict";(()=>{var e={};e.id=643,e.ids=[643],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5753:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>E,patchFetch:()=>m,requestAsyncStorage:()=>_,routeModule:()=>h,serverHooks:()=>R,staticGenerationAsyncStorage:()=>v});var s={};r.r(s),r.d(s,{DELETE:()=>g,GET:()=>p,POST:()=>d,PUT:()=>c});var n=r(9303),a=r(8716),o=r(3131),i=r(7070),u=r(1103),l=r(1171);async function p(e){let t=new URL(e.url),r=t.searchParams.get("type"),s=parseInt(t.searchParams.get("limit")||"50",10),n=t.searchParams.get("featured"),a=t.searchParams.get("homepage"),o=t.searchParams.get("hero");try{let e=["status = 'published'"],t=[];r&&(t.push(r),e.push(`event_type = $${t.length}`)),"true"===n&&e.push("is_featured = true"),"true"===a&&e.push("show_on_homepage = true"),"true"===o&&e.push("show_in_hero = true");let l=`SELECT * FROM events WHERE ${e.join(" AND ")} ORDER BY display_order ASC, start_date ASC LIMIT $${t.length+1}`;t.push(s);let p=await (0,u.IO)(l,t);return i.NextResponse.json({data:p.rows})}catch(e){return console.error(e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function d(e){try{let t=await e.json(),r=t.slug?t.slug:(0,l.l)(t.title||""),s=await (0,u.IO)("INSERT INTO events (title, description, event_type, start_date, end_date, location, poster_image, slug, status) VALUES ($1,$2,$3,$4,$5,$6,$7,$8,'published') RETURNING *",[t.title,t.description||null,t.event_type||null,t.start_date||null,t.end_date||null,t.location||null,t.poster_image||null,r]);return i.NextResponse.json({data:s.rows[0]},{status:201})}catch(e){return console.error(e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function c(e){try{let t=await e.json();if(!t.id)return i.NextResponse.json({error:"Missing id"},{status:400});let r=await (0,u.IO)("SELECT * FROM events WHERE id=$1 LIMIT 1",[t.id]);if(0===r.rows.length)return i.NextResponse.json({error:"Not found"},{status:404});let s=r.rows[0],n=t.slug?t.slug:(0,l.l)(t.title||s.title||""),a=await (0,u.IO)("UPDATE events SET title=$1, description=$2, event_type=$3, start_date=$4, end_date=$5, location=$6, poster_image=$7, slug=$8, updated_at=NOW() WHERE id=$9 RETURNING *",[t.title||s.title,t.description??s.description,t.event_type||s.event_type,t.start_date||s.start_date,t.end_date||s.end_date,t.location||s.location,t.poster_image||s.poster_image,n,t.id]);return i.NextResponse.json({data:a.rows[0]})}catch(e){return console.error(e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function g(e){try{let t=(await e.json()).id;if(!t)return i.NextResponse.json({error:"Missing id"},{status:400});return await (0,u.IO)("DELETE FROM events WHERE id=$1",[t]),i.NextResponse.json({success:!0})}catch(e){return i.NextResponse.json({error:"Internal server error"},{status:500})}}let h=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/events/route",pathname:"/api/events",filename:"route",bundlePath:"app/api/events/route"},resolvedPagePath:"/workspaces/HK/app/api/events/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:_,staticGenerationAsyncStorage:v,serverHooks:R}=h,E="/api/events/route";function m(){return(0,o.patchFetch)({serverHooks:R,staticGenerationAsyncStorage:v})}},1103:(e,t,r)=>{r.d(t,{IO:()=>o});let s=require("pg"),n=process.env.DATABASE_URL||"postgresql://user:pass@localhost:5432/hka",a=new s.Pool({connectionString:n});async function o(e,t){return await a.query(e,t)}},1171:(e,t,r)=>{function s(e){if(!e)return"";let t={ş:"s",Ş:"s",ç:"c",Ç:"c",ğ:"g",Ğ:"g",ü:"u",Ü:"u",ö:"o",Ö:"o",ı:"i",İ:"i"};return e.split("").map(e=>t[e]||e).join("").toLowerCase().replace(/[^a-z0-9\s-]/g,"").trim().replace(/\s+/g,"-").replace(/-+/g,"-")}r.d(t,{l:()=>s})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,972],()=>r(5753));module.exports=s})();